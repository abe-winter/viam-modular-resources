on:
  release:
    types: [published]
    secrets:
      VIAM_API_KEY:
        required: true

jobs:
  module-upload:
    runs-on: ubuntu-latest
    steps:
    - name: Check out RDK
      uses: actions/checkout@v3
      with:
        repository: viamrobotics/rdk
        path: ./rdk
        ref: refs/heads/main

    - name: Download release tarball
      uses: robinraju/release-downloader@v1.8
      with:
        tag: ${{ github.event.release.tag_name }}
        tarBall: true
  
    - name: Module Upload for linux/arm64
      working-directory: ./rdk/cli
      run: go run viam/main.go module upload --platform "linux/arm64" --org_id 1a38b76f-cac0-451c-8f72-670994fcaf5b --name "mod2" --version ${{github.event.release.tag_name}} ../../viam-modular-resources-${{github.event.release.tag_name}}.tar.gz